(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{236:function(e,t,a){"use strict";a.r(t);a(238);var n=a(239),r=a.n(n),c=a(78),o=a.n(c),l=(a(121),a(79)),i=a.n(l),s=(a(241),a(242)),u=a.n(s),m=(a(243),a(244)),d=a.n(m),p=a(77),f=a.n(p),h=a(0),E=a.n(h),g=a(16),v=a.n(g),y=a(46),w=a(237),_=a(283),b=a.n(_),W=a(80),x=a(284),j=a.n(x),N=Object(h.memo)((function(e){var t=e.colors,a=e.visible,n=e.selectColor;return E.a.createElement("div",{className:v()(j.a.colorWrapper,o()({},j.a.colorHidden,!a))},t.map((function(e){return E.a.createElement("div",{key:e,className:j.a.colorItem,onClick:function(){n(e)}},E.a.createElement("span",{style:{backgroundColor:e}}))})))})),k=a(285),O=a.n(k),C=Object(h.memo)((function(e){var t=e.lines,a=e.color,n=e.visible,r=e.selectLineWidth;return E.a.createElement("div",{className:v()(O.a.lineWrapper,o()({},O.a.linesHidden,!n))},t.map((function(e){return E.a.createElement("div",{key:e,className:O.a.lineItem,onClick:function(){r(e)}},E.a.createElement("span",{className:O.a.width},e),E.a.createElement("div",{className:O.a.line,style:{backgroundColor:a,height:e}}))})))})),D=["#F44336","#E91E63","#9C27B0","#2196F3","#48C6FF","#4CAF50","#8BC34A","#FFEB3B","#FFC107","#FF9800","#795548","#607D8B","#000","#666","#999","#BBB","#DDD","#FFF"],I=[2,4,6,8,10,12,16,20],S=a(286),L=a.n(S),H=Object(h.memo)((function(e){var t=e.isPainter,a=e.actionData,n=e.imageData,r=e.sendActionData,c=e.sendImageData,o=Object(h.useRef)(null),l=Object(h.useState)(0),i=f()(l,2),s=i[0],u=i[1],m=Object(h.useState)(0),d=f()(m,2),p=d[0],g=d[1],v=Object(h.useState)([]),y=f()(v,2),w=y[0],_=y[1],b=Object(h.useState)(-1),W=f()(b,2),x=W[0],j=W[1],k=Object(h.useState)(!1),O=f()(k,2),S=O[0],H=O[1],R=Object(h.useState)("#000"),F=f()(R,2),T=F[0],A=F[1],G=Object(h.useState)(!1),U=f()(G,2),B=U[0],X=U[1],P=Object(h.useState)(4),K=f()(P,2),J=K[0],q=K[1],M=function(){var e=o.current.toDataURL();_((function(t){return t.filter((function(e,t){return t<=x})).concat(e)}))},Q=function(e){for(var t=o.current,a=e.nativeEvent.touches[0],n=0,r=0;t;)n+=t.offsetTop,r+=t.offsetLeft,t=t.offsetParent;return{x:a.clientX-r,y:a.clientY-n}};return Object(h.useEffect)((function(){var e=o.current.parentElement;u(e.clientWidth),g(e.clientHeight),M()}),[]),Object(h.useEffect)((function(){var e=o.current.getContext("2d");"next"===n.type?(e.clearRect(0,0,s,p),_([]),M()):t||function(e){var t=o.current,a=t.getAttribute("width"),n=t.getAttribute("height"),r=o.current.getContext("2d"),c=new Image;c.onload=function(){r.clearRect(0,0,a,n),r.drawImage(c,0,0)},c.src=e}(n.dataURL)}),[n]),Object(h.useEffect)((function(){!t&&a.data&&function(e){var t=e.type,a=e.data,n=e.setting,r=a.x,c=a.y,l=o.current.getContext("2d");switch(l.strokeStyle=n.color,l.lineWidth=n.lineWidth,t){case"start":l.beginPath(),l.moveTo(r,c);case"move":l.lineTo(r,c),l.stroke()}}(a)}),[a]),Object(h.useEffect)((function(){var e=w[x];t&&c({dataURL:e})}),[w,x]),Object(h.useEffect)((function(){j(w.length-1)}),[w]),Object(h.useEffect)((function(){var e=o.current.getContext("2d"),t=w[x],a=new Image;a.onload=function(){e.clearRect(0,0,s,p),e.drawImage(a,0,0)},a.src=t}),[x,w,S,B]),E.a.createElement("div",{className:L.a.drawWrapper},E.a.createElement("div",{className:L.a.drawingBoard},t&&E.a.createElement("canvas",{ref:o,width:s,height:p,onTouchStart:function(e){var t=Q(e),a=t.x,n=t.y,c=o.current.getContext("2d");c.beginPath(),c.strokeStyle=T,c.lineWidth=J,c.moveTo(a,n),r({type:"start",data:{x:a,y:n},setting:{color:T,lineWidth:J}})},onTouchMove:function(e){var t=Q(e),a=t.x,n=t.y,c=o.current.getContext("2d");c.strokeStyle=T,c.lineWidth=J,c.lineTo(a,n),c.stroke(),r({type:"move",data:{x:a,y:n},setting:{color:T,lineWidth:J}})},onTouchEnd:function(e){o.current.getContext("2d").closePath(),M()}},"你浏览器连canvas都不支持还玩啥，洗洗睡吧"),!t&&E.a.createElement("canvas",{ref:o,width:s,height:p},"你浏览器连canvas都不支持还玩啥，洗洗睡吧"),t&&E.a.createElement(N,{visible:S,colors:D,selectColor:function(e){A(e),H(!1)}}),t&&E.a.createElement(C,{visible:B,lines:I,color:T,selectLineWidth:function(e){q(e),X(!1)}})),t&&E.a.createElement("div",{className:L.a.toolWrapper},E.a.createElement("div",{className:L.a.toolItem,onClick:function(){H(!S),X(!1)}},E.a.createElement("div",{className:L.a.toolColor,style:{backgroundColor:T}})),E.a.createElement("div",{className:L.a.toolItem,onClick:function(){X(!B),H(!1)}},E.a.createElement("div",{className:L.a.toolLine,style:{backgroundColor:T,height:J}}),E.a.createElement("span",null,J)),E.a.createElement("div",{className:L.a.toolItem,onClick:function(){x>0&&j(x-1)}},E.a.createElement("svg",{className:"icon","aria-hidden":"true"},E.a.createElement("use",{xlinkHref:"#iconchexiao"}))),E.a.createElement("div",{className:L.a.toolItem,onClick:function(){x<w.length-1&&j(x+1)}},E.a.createElement("svg",{className:"icon","aria-hidden":"true"},E.a.createElement("use",{xlinkHref:"#iconxingzhuang"}))),E.a.createElement("div",{className:L.a.toolItem,onClick:function(){o.current.getContext("2d").clearRect(0,0,s,p),M()}},E.a.createElement("svg",{className:"icon","aria-hidden":"true"},E.a.createElement("use",{xlinkHref:"#iconshanchu"})))))}));t.default=function(e){var t=Object(h.useContext)(y.a),a=t.state,n=t.dispatch,c=a.gameInfo,l=a.socket,s=(a.roomData,a.uid),m=a.username,p=c.painter,g=c.players,_=void 0===g?[]:g,x=c.key,j=c.gameTime,N=c.isPainter,k=Object(h.useRef)(null),O=Object(h.useRef)(null),C=Object(h.useRef)(null),D=Object(h.useState)({}),I=f()(D,2),S=I[0],L=I[1],R=Object(h.useState)({}),F=f()(R,2),T=F[0],A=F[1],G=Object(h.useState)(""),U=f()(G,2),B=U[0],X=U[1],P=Object(h.useState)([]),K=f()(P,2),J=K[0],q=K[1],M=Object(h.useState)(!1),Q=f()(M,2),V=Q[0],Z=Q[1],z=Object(h.useState)(!1),Y=f()(z,2),$=Y[0],ee=Y[1],te=Object(h.useState)(""),ae=f()(te,2),ne=ae[0],re=ae[1],ce=Object(h.useMemo)((function(){return J.length>0}),[J]);return Object(h.useEffect)((function(){var e;e=N?"你来画":"由".concat(p.username,"作画"),d.a.info(e,1)}),[p,N]),Object(h.useEffect)((function(){l.on("imageData",(function(e){L(e)})),l.on("gameData",(function(e){n({type:"update_game_time_data",payload:e})})),l.on("drawAction",(function(e){A(e)})),l.on("message",(function(e){var t,a=e.type,r=e.playerName;switch(a){case"answer":t="".concat(r,"答对了 +").concat(e.score,"分");break;case"normal":t="".concat(r," 说: ").concat(e.message);break;case"notify":t="".concat(r).concat(e.message)}e.resScore&&n({type:"update_score",payload:e.resScore}),q((function(e){return e.concat({msg:t,type:a})}))})),l.on("timeover",(function(e){})),l.on("thisOver",(function(e){re(e.answer),Z(!0),n({type:"update_score",payload:e.resScore})})),l.on("nextPlay",(function(e){L({type:"next",dataURL:""}),Z(!1),n({type:"update_game_info",payload:e})})),l.on("gameover",(function(e){Z(!1),ee(!0)})),Object(w.a)(l)}),[]),Object(h.useEffect)((function(){var e=k.current;return C.current?J.length||clearInterval(C.current):J.length&&(C.current=setInterval((function(){e.scrollLeft++,e.scrollLeft>=e.clientWidth+O.current.clientWidth&&(clearInterval(C.current),C.current=null,e.scrollLeft=0,q([]))}),20)),function(){clearInterval(C.current),C.current=null}}),[J]),E.a.createElement("div",{className:b.a.gameWrapper},E.a.createElement(W.a,{leftClass:b.a.leftKey,left:E.a.createElement("div",null,E.a.createElement("span",null,N?"请画: ":"提示: "),E.a.createElement("span",null,x)),right:j}),E.a.createElement(H,{isPainter:N,imageData:S,actionData:T,sendActionData:function(e){l.emit("drawAction",e)},sendImageData:function(e){l.emit("imageData",e)}}),!N&&E.a.createElement("div",{className:b.a.answerWrapper},E.a.createElement(u.a,{clear:!0,className:b.a.answerInput,placeholder:"输入答案哟～",value:B,onChange:function(e){X(e)}}),E.a.createElement(i.a,{type:"primary",inline:!0,style:{height:44,borderRadius:0},onClick:function(){if(B){var t=e.match.params.id;l.emit("answer",{gameId:t,answer:B,answerer:{uid:s,username:m}}),X("")}else d.a.info("别这么皮～",1)}},"发送")),E.a.createElement("div",{className:b.a.playersWrapper},E.a.createElement("div",{className:b.a.playersList},_.map((function(e){var t;return E.a.createElement("div",{key:e.uid,className:v()(b.a.playerItem,(t={},o()(t,b.a.painter,e.isPainter),o()(t,b.a.me,e.uid===s),o()(t,b.a.offline,1===e.status),t))},E.a.createElement("div",{className:b.a.playerHead},e.username[0],E.a.createElement("div",{className:b.a.score},e.score,"分")),E.a.createElement("div",{className:b.a.playerName},e.username))})))),E.a.createElement("div",{className:b.a.textScrollWrapper,ref:k,style:{opacity:ce?1:0}},E.a.createElement("div",{className:b.a.textAutoScroll},E.a.createElement("div",{className:b.a.textList,ref:O},J.map((function(e,t){return E.a.createElement("span",{key:t,className:b.a[e.type]},e.msg)}))))),E.a.createElement(r.a,{title:"这轮结束啦",transparent:!0,visible:V},E.a.createElement("span",null,"答案是: ",E.a.createElement("span",{className:b.a.answerText},ne))),E.a.createElement(r.a,{title:"游戏结果",transparent:!0,visible:$,footer:[{text:"返回房间",onPress:function(){var t=e.match.params.id;e.history.push("/room/".concat(t))}}]},E.a.createElement("div",null,_.sort((function(e,t){return t.score-e.score})).map((function(e,t){return E.a.createElement("div",{key:e.uid},E.a.createElement("span",null,"第",t+1,"名: "),E.a.createElement("span",null,e.username),E.a.createElement("span",{style:{marginLeft:8,fontWeight:"bold"}},e.score,"分"))})))))}},237:function(e,t,a){"use strict";a.d(t,"a",(function(){return c}));a(238);var n=a(239),r=a.n(n),c=function(e){e.on("disconnect",(function(){r.a.alert("阿欧","服务器宕机了，老铁～",[{text:"刷新试试吧",onPress:function(){window.location.href="/"}}])}))}},283:function(e,t,a){e.exports={"game-wrapper":"_2RZW96wGTpQ5CVvnHmkEw9",gameWrapper:"_2RZW96wGTpQ5CVvnHmkEw9","left-key":"_2n0mbY0r8WOJ_gq_Y1HNLg",leftKey:"_2n0mbY0r8WOJ_gq_Y1HNLg","answer-wrapper":"PIqSTBeKHMZDGOyX0WsQl",answerWrapper:"PIqSTBeKHMZDGOyX0WsQl","answer-input":"MtJdXDHgKKJ4q2Nre-2lU",answerInput:"MtJdXDHgKKJ4q2Nre-2lU","players-wrapper":"_3_s848l6EjS6C7Wyzj3Xo5",playersWrapper:"_3_s848l6EjS6C7Wyzj3Xo5","players-list":"_23ZGn3WAXXLyNj0GH3bo7L",playersList:"_23ZGn3WAXXLyNj0GH3bo7L","player-item":"_3ThUos55UMK5yw8cqHhJ6m",playerItem:"_3ThUos55UMK5yw8cqHhJ6m",offline:"WzIh6uLPeSlRVrOkcDIRr","player-head":"_3unvfPqwok2R-EgRDrTNlh",playerHead:"_3unvfPqwok2R-EgRDrTNlh",painter:"_1T_QZ-kegwPvhIKcd3TY3r",me:"RU5xy3G7TFoCet_fLOE79",score:"_3KRYVU0ErmMOpHvypFC-7o","player-name":"_2zmfLswgFTD2Cq0HRviCbX",playerName:"_2zmfLswgFTD2Cq0HRviCbX","text-scroll-wrapper":"_1eR5aQeuQ7Zs75Jw7jzDsE",textScrollWrapper:"_1eR5aQeuQ7Zs75Jw7jzDsE","text-auto-scroll":"_1hi8UCdUKFRxWSHkHQVVw9",textAutoScroll:"_1hi8UCdUKFRxWSHkHQVVw9","text-list":"_1pWJsEixMREIKn7fW-sicA",textList:"_1pWJsEixMREIKn7fW-sicA",normal:"CFpmm90MWOICatG_ujJ-Q",answer:"_15pshVrUJFwd-8kVYpaq2N",notify:"_3MYPjonzfccwHv9ngdLNTB","answer-text":"_3TBAGFXVd-BjgZWRgwNEhk",answerText:"_3TBAGFXVd-BjgZWRgwNEhk"}},284:function(e,t,a){e.exports={"color-wrapper":"_1HM7x-lDDFJANB9lk7uwLc",colorWrapper:"_1HM7x-lDDFJANB9lk7uwLc","color-hidden":"_1eGk7v_nWD-uOsFs9zbUml",colorHidden:"_1eGk7v_nWD-uOsFs9zbUml","color-item":"_3g15mIEam8O6p_AttY81qd",colorItem:"_3g15mIEam8O6p_AttY81qd"}},285:function(e,t,a){e.exports={"line-wrapper":"_3DBtFtdT5eVlqaux-QupX8",lineWrapper:"_3DBtFtdT5eVlqaux-QupX8","lines-hidden":"_2cHxD-jrTBRttYW9JD5Qch",linesHidden:"_2cHxD-jrTBRttYW9JD5Qch","line-item":"_1qyGKzoOhRfUFUhhiDsguE",lineItem:"_1qyGKzoOhRfUFUhhiDsguE",width:"zhAH_Av4nBN9ghuG2zfXt",line:"_2iKM3f7xs6g7cEuUSIhUDT"}},286:function(e,t,a){e.exports={"draw-wrapper":"_3P0wWn8ZPAoEKLDxVFreiL",drawWrapper:"_3P0wWn8ZPAoEKLDxVFreiL",drawingBoard:"_2WrdgUFRm8uT1Z0XSTUaN8","tool-wrapper":"rfQXF7qJbhdpGApA9ZPWt",toolWrapper:"rfQXF7qJbhdpGApA9ZPWt","tool-item":"_2mGhfZ0jag2kVXGdHeLj39",toolItem:"_2mGhfZ0jag2kVXGdHeLj39","tool-color":"pdASKSzGdG_eBHjLX-I68",toolColor:"pdASKSzGdG_eBHjLX-I68","tool-line":"_1blfNLMua2araIrheSa-e9",toolLine:"_1blfNLMua2araIrheSa-e9"}}}]);
//# sourceMappingURL=5.12fe363b12862adfe059.js.map